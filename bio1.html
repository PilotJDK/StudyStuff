<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Biology I — StudyStuff</title>
  <style>
    :root{--bg:#f7f7fb;--card:#fff;--accent:#0ea5a4;--muted:#6b7280}
    body{font-family:Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:0;background:var(--bg);color:#111}
    .page{max-width:1100px;margin:1.5rem auto;padding:1rem;display:grid;grid-template-columns:1fr 300px;gap:1rem}
    .card{background:var(--card);padding:1rem;border-radius:8px;box-shadow:0 6px 18px rgba(20,20,40,0.06)}
    h1{margin:.2rem 0 1rem}

    /* Notes column */
    .notes{display:block}
    .unit{margin-bottom:1.25rem}
    .unit h2{margin:.4rem 0}
    .subunit{margin:0.5rem 0;padding:0.6rem;border-left:3px solid rgba(0,0,0,0.04);background:rgba(0,0,0,0.01);border-radius:4px}
    .note-controls{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.75rem}
    .btn{background:var(--accent);color:white;padding:.35rem .6rem;border-radius:6px;text-decoration:none;border:none;cursor:pointer}
    .btn.secondary{background:#2563eb}
    .micro{font-size:.85rem;color:var(--muted)}

    /* TOC / tab bar on right (sticky) */
    .toc{position:relative}
    .toc-inner{position:sticky;top:1rem}
    .toc h3{margin:.2rem 0}
    .toc-list{list-style:none;padding:0;margin:0;display:block}
    .toc-list li{padding:.35rem .4rem;border-radius:6px;cursor:pointer}
    .toc-list li:hover{background:rgba(37,99,235,0.06)}
    .toc-list .sub{font-size:.95rem;color:var(--muted);padding-left:.8rem}
    .toc-actions{display:flex;gap:.4rem;margin-bottom:.6rem}
    .search{width:100%;padding:.4rem;border-radius:6px;border:1px solid rgba(0,0,0,0.08)}
    /* choice arrow on the right */
    .choice::after{content:'›';float:right;color:#94a3b8;font-weight:600}
    .choice.selected::after{color:#0ea5a4}
    /* highlight matches */
    mark{background:gold;color:#000;padding:0 .12rem;border-radius:2px}

    /* Quiz area */
    .quiz .score{display:flex;justify-content:space-between;align-items:center;margin-bottom:.6rem}
    .question{margin:0.4rem 0 0.8rem}
    .choices{display:flex;flex-direction:column;gap:.5rem}
    .choice{display:flex;align-items:center;justify-content:space-between;padding:.6rem;border-radius:6px;border:1px solid rgba(0,0,0,0.06);cursor:pointer;background:white}
    .choice.selected{outline:2px solid rgba(37,99,235,0.22)}
    .choice.correct{background:rgba(16,185,129,0.12);border-color:rgba(16,185,129,0.2)}
    .choice.wrong{background:rgba(239,68,68,0.06);border-color:rgba(239,68,68,0.12)}
    .small{font-size:.9rem;color:var(--muted)}
    .controls{display:flex;gap:.5rem;margin-top:.75rem}
    .controls .btn.disabled{opacity:.5;pointer-events:none}

    /* responsive */
    @media (max-width:900px){
      .page{grid-template-columns:1fr;}
      .toc{order:2}
      .toc-inner{position:static;margin-top:1rem}
    }
    /* Sidebar styles (shared) */
    #sidebar-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.35);opacity:0;pointer-events:none;transition:opacity .18s ease;z-index:1190}
    #sidebar-overlay.visible{opacity:1;pointer-events:auto}
    #sidebar{position:fixed;left:0;top:0;height:100%;width:320px;max-width:90vw;background:#fff;border-right:1px solid rgba(0,0,0,0.06);box-shadow:10px 0 30px rgba(20,20,40,0.12);transform:translateX(-110%);transition:transform .22s cubic-bezier(.2,.9,.3,1);display:flex;flex-direction:column;z-index:1200}
    #sidebar.open{transform:translateX(0)}
    #sidebar .sidebar-header{padding:1rem;border-bottom:1px solid rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:space-between}
    #sidebar .sidebar-body{padding:1rem;overflow:auto;flex:1}
    #sidebar .sidebar-body li{cursor:pointer;padding:0.15rem 0.25rem;border-radius:4px}
    #sidebar .sidebar-body li:hover{background:rgba(37,99,235,0.06)}
    .card-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.5rem}
    .card h2{font-size:1.25rem;margin:.1rem 0 .5rem}
    .quiz h2{font-size:2rem;margin:.2rem 0 .4rem}
    #sidebar .close-btn{background:transparent;border:none;font-size:1.1rem;cursor:pointer}
    .unit-controls{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .unit-controls label{display:flex;align-items:center;gap:.25rem;font-size:.85rem}
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar-overlay"></div>
  <aside id="sidebar" aria-hidden="true">
    <div class="sidebar-header">
      <strong>StudyStuff:</strong>
      <button class="close-btn" id="close-sidebar" aria-label="Close sidebar">✕</button>
    </div>
    <div class="sidebar-body">
      <section><h3>Testing:</h3><ul><li class="sidebar-item" data-id="act">ACT</li><li class="sidebar-item" data-id="sat">SAT</li><li class="sidebar-item" data-id="psat">PSAT</li></ul></section>
      <section><h3>Math:</h3><ul><li class="sidebar-item" data-id="math3">Math III</li></ul></section>
      <section><h3>History:</h3><ul><li class="sidebar-item" data-id="apworld">AP World History</li></ul></section>
      <section><h3>Science:</h3><ul><li class="sidebar-item" data-id="bio1">Biology I Honors</li></ul></section>
    </div>
  </aside>
  <div class="page">
    <div>
        <!-- top controls removed; moved to the right-side Settings card -->

      <div class="card" style="margin-bottom:.8rem">
        <h1>Biology I Honors</h1>
      </div>

      <div id="notes-card" class="card">
        <div class="card-header">
          <h2>Notes</h2>
          <div class="unit-controls" id="unit-controls-header">
            <!-- Unit checkboxes will be added here dynamically -->
          </div>
        </div>
        <div class="note-controls">
          <input id="search-notes" class="search" placeholder="Search notes (keywords)..." />
          <button id="export-notes" class="btn secondary">Export Notes</button>
          <span class="micro">Notes are read-only here; export is available.</span>
        </div>
        <div id="notes" class="notes">
          <!-- Units and subunits will be rendered here -->
        </div>
      </div>

      <div id="quiz-card" class="card quiz" style="margin-top:1rem">
        <div class="score">
          <div>
            <h2>Quiz</h2>
            <div class="small">Answer question types: multiple-choice, select-all, true/false</div>
          </div>
          <div class="micro">Score: <span id="score">0</span> / <span id="total">0</span></div>
        </div>

        <hr />
        <div id="quiz-area">
          <!-- Question will render here -->
        </div>

        <div class="controls">
          <button id="submit-answer" class="btn">Submit Answer</button>
          <button id="next-question" class="btn secondary">Next Question</button>
          <button id="reset-quiz" class="btn" style="background:#ef4444">Reset</button>
        </div>
      </div>
    </div>

    <aside class="toc">
      <div class="card toc-inner">
        <h3>Units</h3>
        <div class="toc-actions">
          <!-- search moved into notes area (read-only) -->
        </div>
        <ul id="toc-list" class="toc-list">
          <!-- TOC generated here -->
        </ul>
        <hr />
        <div style="margin-top:.6rem;display:flex;gap:.4rem;flex-wrap:wrap">
          <button id="select-all-units" class="btn">Select All</button>
          <button id="shuffle-start" class="btn secondary">Shuffle & Start</button>
        </div>
      </div>
    </aside>
  </div>

<script>
// NOTES data model and UI
const NOTES_KEY = 'study_bio_notes_v1';
let notes = JSON.parse(localStorage.getItem(NOTES_KEY) || 'null') || {
  units:[
    {id:'unit1',title:'Unit 1: Cells', sub:[{id:'u1-s1',title:'Cell Structure',content:'Notes about cell structure...'}]},
    {id:'unit2',title:'Unit 2: Genetics', sub:[{id:'u2-s1',title:'DNA & RNA',content:'Notes about DNA...'}]}
  ]
};

const notesEl = document.getElementById('notes');
const tocList = document.getElementById('toc-list');
const searchInput = document.getElementById('search-notes');

function saveNotes(){ localStorage.setItem(NOTES_KEY, JSON.stringify(notes)); }

function escapeRegExp(string){ return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
function highlight(text, term){ if(!term) return text; const esc = escapeRegExp(term); const re = new RegExp('('+esc+')','gi'); return text.replace(re, '<mark>$1</mark>'); }

function renderNotes(filter=''){
  notesEl.innerHTML='';
  tocList.innerHTML='';
  const term = (filter||'').trim();
  notes.units.forEach(unit=>{
    const matchedSubs = unit.sub.filter(s=>{
      if(!term) return true;
      return s.title.toLowerCase().includes(term.toLowerCase()) || s.content.toLowerCase().includes(term.toLowerCase());
    });
    if(matchedSubs.length===0) return; // hide units without matches

    const u = document.createElement('div'); u.className='unit'; u.id = unit.id;
    const h = document.createElement('h2'); h.innerHTML = term ? highlight(unit.title, term) : unit.title;
    u.appendChild(h);

    matchedSubs.forEach(s=>{
      const su = document.createElement('div'); su.className='subunit'; su.id = s.id;
      const st = document.createElement('strong'); st.innerHTML = term ? highlight(s.title, term) : s.title; su.appendChild(st);
      const p = document.createElement('div'); p.innerHTML = '<p class="micro">'+ (term ? highlight(s.content||'<em>No notes yet</em>', term) : (s.content||'<em>No notes yet</em>')) + '</p>';
      su.appendChild(p);
      u.appendChild(su);

      // TOC entry
      const li = document.createElement('li'); li.textContent = unit.title + ' — ' + s.title; li.className='toc-item'; li.onclick = ()=>{ document.getElementById(s.id).scrollIntoView({behavior:'smooth',block:'center'}); };
      tocList.appendChild(li);
    });

    notesEl.appendChild(u);
  });
}

// initial render
renderNotes();

// Adding/editing is disabled — notes are read-only in this view. Use Export to download.

// Export notes
document.getElementById('export-notes').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(notes, null, 2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'bio-notes.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

// Search notes
searchInput.addEventListener('input', ()=>{ renderNotes(searchInput.value); });

/* Highlight active TOC entry on scroll */
window.addEventListener('scroll', ()=>{
  const subs = document.querySelectorAll('.subunit');
  let current = null;
  subs.forEach(s=>{
    const rect = s.getBoundingClientRect();
    if(rect.top <= window.innerHeight*0.4 && rect.bottom >= 0){ current = s.id; }
  });
  document.querySelectorAll('.toc-list li').forEach(li=>li.style.fontWeight='normal');
  if(current){ document.querySelectorAll('.toc-list li').forEach(li=>{ if(li.textContent.includes(document.getElementById(current).querySelector('strong').textContent)) li.style.fontWeight='600'; }); }
});

// QUIZ implementation
const questions = [
  {
    id:'q1', unit:'unit1', type:'multiple', q:'What is the powerhouse of the cell?',
    choices:['Ribosome','Mitochondria','Endoplasmic Reticulum','Golgi Apparatus'],
    answer:1,
    explain:'Mitochondria generate ATP via cellular respiration.',
    explain_each:[
      'Ribosomes synthesize proteins; they do not generate ATP.',
      'Correct — mitochondria produce ATP via oxidative phosphorylation during cellular respiration.',
      'Endoplasmic reticulum handles protein and lipid synthesis, not primary ATP production.',
      'Golgi apparatus modifies and packages proteins for export, not energy production.'
    ]
  },
  {
    id:'q2', unit:'unit2', type:'truefalse', q:'DNA is double-stranded.',
    choices:['True','False'],answer:0,
    explain:'DNA is typically double-stranded forming a double helix.',
    explain_each:[
      'Correct — canonical DNA molecules in cells are two complementary strands forming a double helix.',
      'While some viruses or fragments can be single-stranded, standard cellular DNA is double-stranded.'
    ]
  },
  {
    id:'q3', unit:'unit2', type:'selectall', q:'Which of the following are components of a nucleotide?',
    choices:['Phosphate group','Amino acid','Sugar','Nitrogenous base'],
    answer:[0,2,3],
    explain:'Nucleotides contain a phosphate, a sugar, and a nitrogenous base.',
    explain_each:[
      'Phosphate: Yes — nucleotides have a phosphate group that links sugars in the backbone.',
      'Amino acid: No — amino acids are the building blocks of proteins, not nucleotides.',
      'Sugar: Yes — either ribose (RNA) or deoxyribose (DNA) is present in a nucleotide.',
      'Nitrogenous base: Yes — adenine, thymine/uracil, cytosine, or guanine make up the base.'
    ]
  },
  {
    id:'q4', unit:'unit1', type:'multiple', q:'Which process produces gametes?',
    choices:['Mitosis','Meiosis','Binary fission','Photosynthesis'],
    answer:1,
    explain:'Meiosis reduces chromosome number to produce gametes.',
    explain_each:[
      'Mitosis produces daughter cells identical to the parent; it does not halve chromosome number for gametes.',
      'Correct — meiosis involves two divisions and produces haploid gametes from diploid cells.',
      'Binary fission is used by many prokaryotes for asexual reproduction; it is not meiosis.',
      'Photosynthesis is the process plants use to convert light energy to chemical energy; unrelated to gamete formation.'
    ]
  },
  {
    id:'q5', unit:'unit1', type:'truefalse', q:'Prokaryotic cells have a nucleus.',
    choices:['True','False'],answer:1,
    explain:'Prokaryotes lack a membrane-bound nucleus.',
    explain_each:[
      'Incorrect — prokaryotes do not have a membrane-bound nucleus; their genetic material is in the nucleoid.',
      'Correct — prokaryotes lack a true nucleus enclosed by a membrane.'
    ]
  }
];
let currentIndex = 0; let score = 0; let total = 0; // total answered

const quizArea = document.getElementById('quiz-area');
const scoreEl = document.getElementById('score');
const totalEl = document.getElementById('total');
const submitBtn = document.getElementById('submit-answer');
const nextBtn = document.getElementById('next-question');
const resetBtn = document.getElementById('reset-quiz');

let sessionQuestions = [];

function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); const t=a[i]; a[i]=a[j]; a[j]=t; }
  return a;
}

function buildUnitSelector(){
  const container = document.getElementById('unit-controls-header'); if(!container) return;
  container.innerHTML = '';
  notes.units.forEach(u=>{
    const id = u.id;
    const row = document.createElement('label'); row.style.display='flex'; row.style.alignItems='center'; row.style.gap='0.3rem'; row.style.fontSize='.85rem';
    const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = true; cb.dataset.unit = id; cb.id = 'chk-'+id;
    const span = document.createElement('span'); span.textContent = u.title;
    row.appendChild(cb); row.appendChild(span);
    container.appendChild(row);
  });
}

function getSelectedUnits(){
  const checks = Array.from(document.querySelectorAll('#unit-controls-header input[type="checkbox"]'));
  const sel = checks.filter(c=>c.checked).map(c=>c.dataset.unit);
  return sel.length? sel : notes.units.map(u=>u.id);
}

function buildSessionQuestions(){
  const selected = getSelectedUnits();
  // filter questions by unit (if question.unit exists), otherwise keep
  let pool = questions.filter(q=>{ return !q.unit || selected.includes(q.unit); });
  // deep-copy and shuffle choices per question
  const mapped = pool.map(orig=>{
    const q = JSON.parse(JSON.stringify(orig));
    // shuffle choice order and remap answers/explanations
    const idxs = q.choices.map((_,i)=>i);
    shuffleArray(idxs);
    const newChoices = idxs.map(i=>q.choices[i]);
    const newExplainEach = idxs.map(i=> (q.explain_each && q.explain_each[i]) ? q.explain_each[i] : '');
    // remap answer
    if(Array.isArray(q.answer)){
      const newAns = q.answer.map(origIdx=> idxs.findIndex(n=>n===origIdx)).filter(v=>v>=0);
      q.answer = newAns;
    } else {
      q.answer = idxs.findIndex(n=>n===q.answer);
    }
    q.choices = newChoices; q.explain_each = newExplainEach;
    return q;
  });
  shuffleArray(mapped);
  sessionQuestions = mapped;
  currentIndex = 0; score = 0; total = 0; scoreEl.textContent=score; totalEl.textContent=total;
  renderQuestion(currentIndex);
}

function renderQuestion(idx){
  if(!sessionQuestions || sessionQuestions.length===0){ quizArea.innerHTML = '<div class="small">No questions available for selected units. Use the Units button to select different units.</div>'; submitBtn.disabled=true; nextBtn.disabled=true; return; }
  const q = sessionQuestions[idx];
  quizArea.innerHTML = '';
  const questionEl = document.createElement('div'); questionEl.className='question'; questionEl.innerHTML = `<strong>Q${idx+1}.</strong> ${q.q}`;
  quizArea.appendChild(questionEl);
  const choices = document.createElement('div'); choices.className='choices';

  if(q.type === 'multiple' || q.type === 'truefalse'){
    q.choices.forEach((c,i)=>{
      const ch = document.createElement('div'); ch.className='choice'; ch.tabIndex=0; ch.dataset.index=i; ch.innerHTML = `<span>${c}</span>`;
      ch.onclick = ()=>{ choices.querySelectorAll('.choice').forEach(x=>x.classList.remove('selected')); ch.classList.add('selected'); };
      choices.appendChild(ch);
    });
  } else if(q.type === 'selectall'){
    q.choices.forEach((c,i)=>{
      const ch = document.createElement('label'); ch.className='choice'; ch.style.display='flex'; ch.style.alignItems='center'; ch.style.justifyContent='space-between';
      const left = document.createElement('span'); left.style.display='flex'; left.style.alignItems='center';
      const cb = document.createElement('input'); cb.type='checkbox'; cb.style.marginRight='0.6rem'; cb.dataset.index = i;
      left.appendChild(cb); left.appendChild(document.createTextNode(c));
      ch.appendChild(left);
      choices.appendChild(ch);
    });
  }
  quizArea.appendChild(choices);
  const explainEl = document.createElement('div'); explainEl.id='explain'; explainEl.style.marginTop='0.6rem'; quizArea.appendChild(explainEl);
  submitBtn.disabled = false; nextBtn.disabled = true;
}

function arraysEqual(a,b){ if(a.length!==b.length) return false; a = [...a].sort(); b=[...b].sort(); return a.every((v,i)=>v===b[i]); }

submitBtn.addEventListener('click', ()=>{
  const q = sessionQuestions[currentIndex];
  const choicesEl = quizArea.querySelector('.choices');
  if(!q) return;
  let correct = false;
  let userSelection = null;

  if(q.type === 'multiple' || q.type === 'truefalse'){
    const sel = choicesEl.querySelector('.choice.selected');
    if(!sel){ alert('Please select an answer'); return; }
    const idx = Number(sel.dataset.index); userSelection = idx;
    if(idx === q.answer){ correct = true; sel.classList.add('correct'); } else { sel.classList.add('wrong'); }
  } else if(q.type === 'selectall'){
    const checked = Array.from(choicesEl.querySelectorAll('input[type="checkbox"]')).filter(c=>c.checked).map(c=>Number(c.dataset.index));
    if(checked.length===0){ alert('Select at least one option'); return; }
    userSelection = checked;
    if(arraysEqual(checked, q.answer)){ correct = true; checked.forEach(i=>{ const el = choicesEl.querySelector('[data-index="'+i+'"]').closest('.choice'); if(el) el.classList.add('correct'); }); }
    else { Array.from(choicesEl.querySelectorAll('input[type="checkbox"]')).forEach(c=>{ if(c.checked){ c.closest('.choice').classList.add('wrong'); } }); }
  }

  total += 1; if(correct) score += 1; scoreEl.textContent = score; totalEl.textContent = total;

  const explainEl = document.getElementById('explain'); explainEl.innerHTML = '';
  const list = document.createElement('div'); list.className='micro'; const ul = document.createElement('ul'); ul.style.paddingLeft='1rem';
  q.choices.forEach((choice,i)=>{
    const li = document.createElement('li'); li.style.marginBottom='0.5rem';
    const prefix = (Array.isArray(userSelection) ? (userSelection.includes(i) ? 'Your selection — ' : '') : (userSelection===i ? 'Your selection — ' : ''));
    const correctness = ( (Array.isArray(q.answer) ? q.answer.includes(i) : q.answer===i) ) ? ' (correct)' : ' (incorrect)';
    li.innerHTML = `<strong>${prefix}${choice}</strong>${correctness}<div style="margin-top:0.25rem">${(q.explain_each && q.explain_each[i]) ? q.explain_each[i] : (i===q.answer ? q.explain : '')}</div>`;
    ul.appendChild(li);
  }); list.appendChild(ul); explainEl.appendChild(list);

  submitBtn.disabled = true; nextBtn.disabled = false;
});

nextBtn.addEventListener('click', ()=>{
  if(!sessionQuestions || sessionQuestions.length===0) return;
  currentIndex = (currentIndex + 1) % sessionQuestions.length;
  renderQuestion(currentIndex);
});

resetBtn.addEventListener('click', ()=>{
  if(!confirm('Reset quiz score and progress?')) return;
  score = 0; total = 0; scoreEl.textContent=score; totalEl.textContent=total; currentIndex=0; buildSessionQuestions();
});

// Unit selector handlers
document.getElementById('select-all-units').addEventListener('click', ()=>{ document.querySelectorAll('#unit-controls-header input[type="checkbox"]').forEach(c=>c.checked=true); });
document.getElementById('shuffle-start').addEventListener('click', ()=>{ buildSessionQuestions(); });

// initial setup
buildUnitSelector(); buildSessionQuestions();

</script>
<script>
  (function initSidebar(){
    const overlay = document.getElementById('sidebar-overlay');
    const sidebar = document.getElementById('sidebar');
    const closeBtn = document.getElementById('close-sidebar');
    if (!overlay || !sidebar || !closeBtn) return;
    function hideSidebar(){ sidebar.classList.remove('open'); overlay.classList.remove('visible'); sidebar.setAttribute('aria-hidden','true'); }
    closeBtn.addEventListener('click', hideSidebar);
    overlay.addEventListener('click', hideSidebar);
    document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') hideSidebar(); });
    const sidebarItems = Array.from(document.querySelectorAll('.sidebar-item'));
    sidebarItems.forEach(item=>{ item.addEventListener('click', ()=>{ const id = item.dataset.id; if(id) window.location.href = id + '.html'; }); });
  })();
</script>
</body>
</html>
